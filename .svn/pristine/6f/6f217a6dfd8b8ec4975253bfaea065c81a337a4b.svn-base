<%@ page contentType="text/html; charset=euc-kr" %><%@ page import="java.util.*"%><%@ page import="com.ilk.ansim.vbv_mpi.*"%><%!private static Hashtable errs = null;private static boolean notYet = true;private static void errCodeDef(){	if( notYet ) {		errs = new Hashtable();		errs.put("301",	"고객께서 입력하신 카드번호가 발급사 카드발급범위와 일치하지 않습니다. 카드번호를 확인해주세요.");		errs.put("302",	"고객께서 입력하신 카드번호가 발급사 카드발급범위와 일치하지 않습니다. 카드번호를 확인해주세요.");		errs.put("303",	"고객님께서는 안심클릭에 가입되어 있지 않습니다.");		errs.put("304",	"카드사 시스템문제로 인하여 가입여부를 확인할 수 없습니다. 잠시 후 다시 이용해주세요.");		errs.put("311",	"카드사 시스템문제로 인하여 가입여부를 확인할 수 없습니다. 잠시 후 다시 이용해주세요.");		errs.put("312",	"카드사 시스템문제로 인하여 가입여부를 확인할 수 없습니다. 잠시 후 다시 이용해주세요.");		errs.put("321",	"카드사 시스템문제로 접속되지 않고 있습니다. 잠시 후 다시 이용해주세요.");		errs.put("322",	"카드사 시스템문제로 접속되지 않고 있습니다. 잠시 후 다시 이용해주세요.");		errs.put("323",	"카드사 시스템문제로 접속되지 않고 있습니다. 잠시 후 다시 이용해주세요.");		errs.put("324",	"카드사 시스템문제로 접속되지 않고 있습니다. 잠시 후 다시 이용해주세요.");		errs.put("321",	"카드사 시스템문제로 접속되지 않고 있습니다. 잠시 후 다시 이용해주세요.");		errs.put("332",	"가입여부 확인요청 메시지에 오류가 있음");		errs.put("333",	"카드사의 응답이 유효하지 않음(카드사 문의요망)");		errs.put("334",	"카드사의 응답이 유효하지 않음(카드사 문의요망)");		errs.put("341",	"인증요청 전문 생성 실패");		errs.put("351",	"통신중 문제가 발생하였습니다");		errs.put("401",	"인증결과 전문이 유효하지 않음(카드사 문의요망)");		errs.put("402",	"인증결과 전문 오류(카드사 문의요망)");		errs.put("404",	"인증결과 전문 오류(카드사 문의요망)");		errs.put("405",	"동일 인증요청 전문이 2회이상 들어옴(팝업페이지에서 새로고침을 하시면 정상거래가 되지 않습니다)");		errs.put("406",	"인증결과 전문이 잘못됨(카드사 문의요망)");		errs.put("407",	"인증실패. 인증창에서 취소를 하시면 결제가 되지 않습니다.");		errs.put("408",	"인증불가(카드사 문의요망)");		errs.put("409",	"인증결과 전문 검증시 문제발생(카드사 문의요망)");		errs.put("411",	"인증결과 전문 검증시 문제발생(카드사 문의요망)");		errs.put("412",	"인증결과 전문 검증시 문제발생(카드사 문의요망)");		errs.put("413",	"인증결과 전문 검증시 문제발생(카드사 문의요망)");		errs.put("414",	"인증결과 전문 검증시 문제발생(카드사 문의요망)");		errs.put("415",	"인증결과 전문 검증시 문제발생(카드사 문의요망)");		errs.put("431",	"통신중 문제가 발생하였습니다");		errs.put("501",	"내부 처리 오류(다시한번 시도해 주십시오)");		errs.put("502",	"내부 처리 오류");		errs.put("503",	"내부 처리 오류");		errs.put("611",	"데이터베이스 처리 오류(다시한번 시도해 주십시오)");		errs.put("612",	"데이터베이스 처리 오류(다시한번 시도해 주십시오)");		errs.put("613",	"데이터베이스 처리 오류(다시한번 시도해 주십시오)");
		notYet = false;	}}
%><%	System.out.println("auth_host_mobile.jsp start --------------- ");
	/*	 * Declare error codes.	 */	errCodeDef();
	/*	 * Do not cache this page.	 */	response.setHeader("cache-control","no-cache");	response.setHeader("expires","-1");	response.setHeader("pragma","no-cache");
	/*	 *	Get the form elements	 */	String MD			= request.getParameter("MD");	String PaRes		= request.getParameter("PaRes");	String realPan		= request.getParameter("realPan");
	String status		= "";	String verifyResult	= "";	String xid			= "";	String eci			= "";	String cavv			= "";	String auth_msg		= "";	String proceed		= "true";	String errCode		= "000";	String paresYN		= "Y";	String iReqCode		= "";	String iReqDetail	= "";
	/*	 *	Create mpi component, mpiVbv(ip, port) or mpiVbV(port)	 */	mpiVbV mpi = new mpiVbV(5103);	String success = mpi.validatePayerAuth(PaRes);
	status       = mpi.getStatus();	verifyResult = mpi.getVerifyResult();	xid          = mpi.getXid();	eci          = mpi.getEci();	cavv         = mpi.getCavv();	errCode      = mpi.getErrorCode();	iReqCode     = mpi.getIReqCode();	iReqDetail   = mpi.getIReqDetail();
	if(xid == null)        xid = "";	if(eci == null)        eci = "";	if(cavv == null)       cavv = "";	if(realPan == null)    realPan = "";	if(errCode == null)    errCode = "";	if(iReqCode == null)   iReqCode = "";	if(iReqDetail == null) iReqDetail = "";
	if (!success.equals("Y")) status = "X";
	if( PaRes == null || PaRes.equals("") ) {		auth_msg = "인증실패. 카드사가 인증결과를 넘겨주지 않았습니다.";		errCode = "996";		paresYN = "N";	} else if( !status.equals("Y") && !status.equals("A") && errCode.equals("000") ) {		auth_msg = "인증실패. 인증결과를 알 수 없습니다.";		errCode = "995";	} else if( !errCode.equals("000") ) {		auth_msg = errCode + ": " + errs.get(errCode);	}
	if( MD == null ) MD = xid;
%><html><script type="text/javascript">function onLoadProc() {	var frm = document.frmRet;		var proceed = true;
	if( "<%=auth_msg%>" != "" ) {		proceed = false;		var formNm = parent.document.tranMgr;		formNm.action="../index_card_m.jsp";		formNm.submit();	}
	frm.submit();}
</script>	<body onload="javascript:onLoadProc();">		<form name=frmRet method=post action="<%=MD%>">			<input type=hidden name=xid     value="<%=xid%>">			<input type=hidden name=eci     value="<%=eci%>">			<input type=hidden name=cavv    value="<%=cavv%>">			<input type=hidden name=realPan value="<%=realPan%>">			<input type=hidden name=errCode value="<%=errCode%>">		</form>	</body></html>